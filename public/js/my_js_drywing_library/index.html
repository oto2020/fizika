<!doctype html> 
<html> 
	<head> 
		<meta charset="utf-8"> 
		<title>Задача №5. ДЖИММИ НЕЙТРОН</title> 
		<script src="Point.js"></script>
		<script src="Polygon.js"></script>
		<script src="MyMath.js"></script>
		<script src="Circle.js"></script>
		<script src="myDrawing.js"></script>
		
	</head> 
	<style type="text/css">
		canvas { 
			border: 1px solid black;
			float:left;
			cursor: cell;
			display: inline-block;
		}
		#mainWindow {
			width:1200px;
			height:700px;
		}
		.controlPanel {
			height: 60px;
			width: 1200px;
		}
		.controlElement {
			float: left;
			display: inline-block;
			width: 200px;
			height: 50px;
			border: 1px solid black;
			margin-right: 10px;
			padding: 2px;
		}
		
		.slider {
			width: 200px;
		}
		#circlesColba {
			border: 1px solid white;
			width: 70px;
			height: 600px;
			display: inline-block;
		}

    </style>
	<body> 
		<div id = "mainWindow">
			<div class = "controlPanel">
				<div class = "controlElement">
					<div id = "rangeValue1">Количество шаров: 1</div>
					<input type="range" min="1" max="30" value="1" class="slider" id="rangeOfCirclesCount">
				</div>
				<div class = "controlElement">
					<div id = "rangeValue2">Радиус шаров: 30</div>
					<input type="range" min="3" max="100" value="30" class="slider" id="rangeRadiusOfCircles">
				</div>
				<div class = "controlElement">
					<div id = "rangeValue3">Количество сторон: 10</div>
					<input type="range" min="3" max="30" value="10" class="slider" id="rangeCountOfSides">
				</div>
				<div class = "controlElement" id = "buttons">
					<button id = "gravityButtonOn"  style="width:200px;height:25px">Включить гравитацию </button>
					<button id = "gravityButtonOff" style="width:200px;height:25px">Выключить гравитацию</button>
				</div>
	
			</div>
			<div>
				<canvas id="canvas" width = "1000px" height = "600px"></canvas>
				<div id = "circlesColba">
				</div>
			</div>
		</div>
		
	<script type="text/javascript"> 
		// глобальные переменные
		var circles = [];
		var IS_GRAVITY_ON = false;
		
		// создает HTML-объект колбу и добавляет её к родителю с id = "circlesColba"
		function createColba(N) {
			document.getElementById("circlesColba").innerHTML = ''; // очистка
			for (var i = 0; i < N; i++) {
				var colba =  document.createElement('div');
				  colba.id = 'part_' + i;	
				  colba.style.width  = '70px';
				  colba.style.height = 600/N-2 + 'px';
				  colba.style.background = 'linear-gradient(4deg, #EEEEEE, #FFFFFF)'; // background
				  colba.style.border = '1px solid #DDDDDD';
				  colba.style.borderRadius = '100px';
				document.getElementById("circlesColba").appendChild(colba);
			}	
		}
		
		
		function begin(N) {
			
			// канвас и элементы управления
			var canvas = document.getElementById('canvas'); 
			
			var rangeOfCirclesCount = document.getElementById('rangeOfCirclesCount'); 	// ползунок с выбором количества шаров
			var rangeRadiusOfCircles = document.getElementById('rangeRadiusOfCircles'); // ползунок с выбором радиуса шаров
			var rangeCountOfSides = document.getElementById('rangeCountOfSides'); 		// ползунок с выбором массы шаров
			
			var gravityButtonOn = document.getElementById("gravityButtonOn"); 		// кнопка "Включить гравитацию"
			var gravityButtonOff = document.getElementById("gravityButtonOff"); 	// кнопка "Выключить гравитацию"
			gravityButtonOn.onclick = function(){
				IS_GRAVITY_ON = true;
				document.getElementById("buttons").style.background = "red";
			}
			gravityButtonOff.onclick = function(){
				IS_GRAVITY_ON = false;
				document.getElementById("buttons").style.background = "white";
			}


			// Поверхность для отрисовки и колба с шариками
			const context = canvas.getContext('2d');
			createColba(rangeOfCirclesCount.value);			
			
			// константы
			const CENTER_X = canvas.width/2;  	// 500
			const CENTER_Y = canvas.height/2; 	// 300
			const DELTA_T = 0.015;            	// шаг (в мс).
			const MASSA = 10;					// масса шаров
					
			// создание шариков в зависимости от их количества				
			circles = [];						// массив с шариками
			var alpha = 360 / N;
			for(var a = 0; a < 360 + 0; a+=alpha) { // вращаем угол на значение alpha
				var x = CENTER_X + 250 * Math.cos(a*3.14/180);
				var y = CENTER_Y + 250 * Math.sin(a*3.14/180);
				
				var circle1 = new Circle(new Point(x, y), rangeRadiusOfCircles.value, rangeCountOfSides.value,  myDrawing.randColor()); 		// задали координаты, радиус, кол-во сторон, цвет
				circle1.setStartVelocity(MASSA, CENTER_X, CENTER_Y);	// задали начальную скорость
				
				circle1.calc(IS_GRAVITY_ON, MASSA, rangeCountOfSides.value, rangeRadiusOfCircles.value, DELTA_T);								// расчитали первый раз
				circles.push(circle1);																											// закинули в массив
			}
		
			// Вспомогательная функция, возвращает новую точку в координатах мыши
			function getMousePoint(e) {
				return new Point(e.layerX, e.layerY);
			}
			
			// ИТЕРАЦИЯ ПРОРИСОВКИ И ПЕРЕРАСЧЕТОВ	
			function mainIteration() {
				context.fillStyle = "black";
				context.fillRect(0, 0, canvas.width, canvas.height); 	// ОЧИСТКА ЭКРАНА
	
				for(var i=0; i < circles.length;i++)
				{
					circles[i].calc(IS_GRAVITY_ON, MASSA, rangeCountOfSides.value, rangeRadiusOfCircles.value, DELTA_T);
					circles[i].draw(context);
				}
			}
			
			var mainInterval = setInterval(mainIteration, 1); // пересчет каждую милисекунду

			// Событие MOUSE_UP	(добавление новой точки или завершение построения)	
			canvas.addEventListener('mouseup', e => {
				for(var i = 0; i < circles.length; i++) {
					if(circles[i].isActive) {
						var polygon = circles[i].polygon;
						var mouse = getMousePoint(e);
						if(MyMath.isMouseInPolygon(polygon, mouse)) {
							circles[i].deactivate();
							var colba = document.getElementById('part_'+i); 		// находим колбу по id
							colba.style.background = circles[i].getColor();	// задаем ей цвет шара, по которому попали мышкой
							console.log(i);
							//console.log(document.getElementById('part'+i));
						}
					}
				}
			});	
			
			// ОБНОВЛЕНИЕ ЛЕЙБЛОВ ПОЛЗУНКОВ ПРИ ИХ ИЗМЕНЕНИИ
			rangeOfCirclesCount.oninput = function(){
				document.getElementById('rangeValue1').textContent = "Количество шаров: " + rangeOfCirclesCount.value;
				
				// если задели ползунок с количеством шаров - всё начинется заново
				clearInterval(mainInterval); 		// снимаем с образобки предыдущий обработчик для старых шаров
				begin(rangeOfCirclesCount.value);	// начали всё сначала с новым количеством шаров
			};
			rangeRadiusOfCircles.oninput = function(){
				document.getElementById('rangeValue2').textContent = "Радиус шаров: " + rangeRadiusOfCircles.value;
			};	
			rangeCountOfSides.oninput = function(){
				document.getElementById('rangeValue3').textContent = "Количество сторон: " + rangeCountOfSides.value;
			};	
		}	
		
		// стартуем
		begin(rangeOfCirclesCount.value);
				
	</script>
		
		
		








		
	</body> 
</html>